<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link id=favicon rel=icon type=image/x-icon href=/img/favicon.ico><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/github-markdown.min.css><link rel=stylesheet href=/css/addon.css><meta name=referrer content="no-referrer"><script src=https://unpkg.com/zooming/build/zooming.min.js></script><script>document.addEventListener('DOMContentLoaded',function(){new Zooming({scaleExtra:0.6,}).listen('.img-zoomable')})</script><style>@font-face{font-family:notosanssc;src:url(/css/NotoSansSC-Thin.ttf)}@font-face{font-family:roboto;src:url(/css/Roboto-Regular.ttf)}*{font-family:roboto,notosanssc!important}</style><title>我爱ETF</title></head><body><header id=header><nav class=sidebar-nav><ul><li><a href=/>首页</a></li><li><a href=/dash/>市场仪表盘</a></li><li><a href=/policies/>投资体系</a></li><li><a href=/books/>投资书单</a></li><li><a href=/funds/>精选基金</a></li><li><a href=/tools/>量化工具</a></li><li><a href=/tags/>词云</a></li><li><a href=/blog/>博客</a></li><li><a href=/about/>关于</a></li></ul></nav></header><main id=main><article id=markdown-body><h1>Note of Python import</h1><h3>Friday, Mar 27, 2020</h3><p><h1 id=python-import>Python Import</h1><p>[TOC]</p><h2 id=摘要>摘要</h2><p>本文总结了Python import的方式和错误根因，用一句话总结：无论是相对(.././&mldr;)还是绝对路径(.间隔）导入，都取决于调用文件的命名空间是否存在，如果存在则可以引用，如果不存在则报错。</p><p>在少量文件小程序开发时，是直接运行module文件的形式，可以直接导入名字。在包开发时，要注意采用包的概念去导入本地模块。</p><h2 id=假设目录结构是这样子>假设目录结构是这样子</h2><pre><code>foo1
    │  bar1..py
    │  bar2.py
    │  __init__.py
    │
    └─foo2
            bar1.py
            bar2.py
            __init__.py
	|-- main.py
</code></pre><h2 id=常见导入方式>常见导入方式</h2><p>以下几种写法从语法角度讲都正确，但从导入场景讲<strong>有一些是不正确的</strong>。</p><pre><code>import foo
import foo.bar
from foo import bar
from foo import bar, baz
from foo import *
from foo import bar as fizz
from .foo import bar
foo = __import__(&quot;foo&quot;)
reload(foo)
</code></pre><p>当你被import折磨的欲仙欲死时，先要理解使用场景。就是说不同的调用方式（作为package、作为module文件、作为shell、作为Python3 -m 参数调用）创造出的namesapce（命名空间是不同的）。</p><h4 id=作为独立文件module-被使用>作为独立文件(module) 被使用</h4><p>类似于在Python shell中执行导入，例如</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ Python3 bar1.py
$ Python3
&gt; import bar1.py
</code></pre></div><p>此时，bar1.py虽然位于foo1 package内，但解释器直接调用bar1.py，故foo1命名空间（package）是不存在的，以下import是正确的</p><pre><code># main.py
import foo1
from foo1 import bar1
from foo1 import *
from foo1 import bar as fizz
# bar1.py
import bar2
from bar2 import object
from bar2 import *
from bar2 import object as object_new_name
</code></pre><p>以下写法是错误的，因为解释器执行时，foo1的namespace不存在。</p><pre><code>#bar1.py
import .bar2 #不存在同级命名空间和父空间
import foo1.bar2 #不存在
from foo1 import bar2
</code></pre><h4 id=作为包或者包的一部分子包模块被调用>作为包或者包的一部分（子包、模块）被调用</h4><p>例如main.py中导入了foo1, foo1.py导入了bar1, bar1又导入了bar2，甚至引入foo1的对象。这种方式就是作为包被连续调用，因为并没有被shell直接调用执行。此时，以下看似正确的写法就是错误的</p><pre><code># bar1.py
import bar2 #报错，提示bar2不存在，正确写法是import foo1.bar2 or import .bar2
</code></pre><p>以下是正确的</p><pre><code># main.py
import foo1
#bar1.py
from . import bar2
import .bar2
from .bar2 import object
import foo1.foo2.bar1 # 可以直接调用，因为foo1 namespace存在
from foo1.foo2 import bar1 #
from . import foo2.bar1
# foo2/bar1.py
from .. import bar1, bar2
</code></pre><h4 id=仅仅-import-package>仅仅 import package</h4><p>package被import后，默认只有package.__init__的初始化对象被import，其下属所有module, sub-package都没有被import，所以下面写法也会报错</p><pre><code># main.py
import foo1
foo1.bar1 #报错，因为默认module不被import，除非在foo1的__init__.py显性import
foo1.bar1.object(paras) #报错，因为bar1没有被import

</code></pre><h2 id=相对和绝对import>相对和绝对import</h2><p>当命名空间存在时，使用绝对路径和相对路径都可以，各有优劣；但当不存在时（比如直接运行模块文件、shell解释器导入），会报错。</p></p></div></article><article id=article_tags><a class=item__tag href=/tags/python>#Python</a></article><div style=text-align:center><img src=/img/weixin.jpg width=110px;><p>扫码关注：<strong>结丹记事本儿</strong>，更新有提醒</p></div><article id=article_nav><a href=http://52etf.net/blog/2020-05-06-%E7%AE%80%E5%8D%95%E5%87%86%E7%A1%AE%E7%9A%84%E7%90%86%E8%A7%A3%E5%80%BA%E5%88%B8%E5%B8%82%E5%9C%BA%E4%BA%8C/>新一篇：简单准确的理解债券市场（二）</a>
<a href=http://52etf.net/blog/2019-09-01-ielts-speaking-part-1/>老一篇：IELTS Speaking Test - Part 1</a> &nbsp;</article><script src=//unpkg.com/valine/dist/Valine.min.js></script><div id=vcomments></div><script>new Valine({el:'#vcomments',appId:'oc9Q6EXPyOTsTB1u3TF69zx5-gzGzoHsz',appKey:'K9hd59av2lhDkYwXfBGAHFdB',placeholder:'请您在评论时遵守国家法律法规，谢谢',visitor:false,})</script></main><footer id=footer><ul><li><a href=http://52etf.net>版权&copy;52etf.net</a></li><li><a href=https://creativecommons.org/licenses/by-sa/4.0/deed.zh>协议CC BY-SA 4.0</a></li><li><a href=http://www.beian.miit.gov.cn>豫ICP备20016066号</a></li></ul></footer></body></html>