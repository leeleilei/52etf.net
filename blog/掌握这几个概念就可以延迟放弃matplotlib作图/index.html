<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link id=favicon rel=icon type=image/x-icon href=/img/favicon.ico><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/github-markdown.min.css><link rel=stylesheet href=/css/addon.css><meta name=referrer content="no-referrer"><script src=https://unpkg.com/zooming/build/zooming.min.js></script><script>document.addEventListener('DOMContentLoaded',function(){new Zooming({scaleExtra:0.6,}).listen('.img-zoomable')})</script><style>@font-face{font-family:notosanssc;src:url(/css/NotoSansSC-Thin.ttf)}@font-face{font-family:roboto;src:url(/css/Roboto-Regular.ttf)}*{font-family:roboto,notosanssc!important}</style><title>我爱ETF</title></head><body><header id=header><h1><a href=/>我爱ETF</a></h1><nav class=sidebar-nav><a href=/dash/>市场仪表盘</a> |
<a href=/policies/>投资体系</a> |
<a href=/books/>投资书单</a> |
<a href=/funds/>精选基金</a> |
<a href=/tools/>量化工具</a> |
<a href=/tags/>Tags</a> |
<a href=/blog/>博客</a> |
<a href=/about/>关于</a> |</nav></header><main id=main><article class="single markdown-body"><h1>掌握这几个概念就可以延迟放弃matplotlib作图</h1><h3>Saturday, Jun 13, 2020</h3><p><p>印象中放弃过这个库数次，改用了plotly和altair的html类型作图。后来发现还是matplotlib要稳定灵活，兼容Qt程序方面也是最好的。</p><p>但有几个坑可以加速新手的放弃的意愿，</p><h2 id=中文字体设置>中文字体设置</h2><p><img src=https://cdn.jsdelivr.net/gh/leeleilei/leeleilei.github.io/assets/images/20200613210510.png alt=20200613210510></p><p>看到方格子是很脑裂的事，尤其是被Python2的Unicode摩擦过的人。</p><p>Do This</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># 设置matplotlib正常显示中文和负号</span>
matplotlib<span style=color:#f92672>.</span>rcParams[<span style=color:#e6db74>&#39;font.sans-serif&#39;</span>]<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;SimHei&#39;</span>]   <span style=color:#75715e># 用黑体显示中文</span>
matplotlib<span style=color:#f92672>.</span>rcParams[<span style=color:#e6db74>&#39;axes.unicode_minus&#39;</span>]<span style=color:#f92672>=</span>False     <span style=color:#75715e># 正常显示负号</span>
</code></pre></div><p>或者 Do This 单独挂载字体</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> matplotlib.font_manager <span style=color:#f92672>as</span> fm
<span style=color:#75715e># 设置字体路径</span>
path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/usr/share/fonts/truetype/SimHei.ttf&#39;</span>
fontprop <span style=color:#f92672>=</span> fm<span style=color:#f92672>.</span>FontProperties(fname<span style=color:#f92672>=</span>path, size<span style=color:#f92672>=</span><span style=color:#ae81ff>13</span>)
<span style=color:#75715e>#每一个涉及font的地方，引用fontproperties</span>
plt<span style=color:#f92672>.</span>title(<span style=color:#e6db74>&#34;模型结果&#34;</span>,fontproperties<span style=color:#f92672>=</span>fontprop)
plt<span style=color:#f92672>.</span>xlabel(<span style=color:#e6db74>&#34;X值&#34;</span>,fontproperties<span style=color:#f92672>=</span>fontprop)
plt<span style=color:#f92672>.</span>ylabel(<span style=color:#e6db74>&#34;Y值&#34;</span>,fontproperties<span style=color:#f92672>=</span>fontprop)
</code></pre></div><h2 id=figure>Figure</h2><p><img src=https://cdn.jsdelivr.net/gh/leeleilei/leeleilei.github.io/assets/images/20200613211333.png alt=20200613211333></p><p>这个图比较言简意赅的说明这几个关键概念的区别。Figure就是默认的一张画布。</p><h2 id=axes>Axes</h2><p>Axes = Axe的复数，指x,y的Axis。
有趣的是一个Figure上可以包含多个Axes，即子图的概念。</p><h2 id=subplot>subplot</h2><p>我们见过最多的写法是 fig, ax = plt.subplot()</p><p>subplot会返回一个tuple，(fig, ax) 默认一个figure和一个axes。当然也可以初始化nrows,ncols,zlocation，例如</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>fig, [ax1, ax2, ax3] <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>subplot(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>3</span>)
</code></pre></div><p>注意并没有用</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>fig, ax1, ax2, ax3 <span style=color:#f92672>=</span> plot<span style=color:#f92672>.</span>subplot(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>3</span>)
</code></pre></div><p>因为tuple里面是(figure, axes)的结构，axes可以是一个或者n维的list</p><h2 id=plot>plot</h2><p>plot()本身是个作图函数(y, x, type, label)，跟以上概念没有关联。
当用pandas直接plot时会默认创建一系列的figure和axes，仍然建议按照fig, ax的写法遵从一致性。</p><h2 id=ticker>ticker</h2><p>axes图上x,y axis的major_ticker和minor_ticker刻度值</p><h2 id=label>label</h2><p>文字标签</p><h2 id=日期的处理>日期的处理</h2><p>这个可以劝退一半以上的使用者，因为不够智能，会导致x坐标显示失真。</p><p>跟python默认的datetime函数比较像，没理解原理怎么用都难受，还要依赖外部库，可实际上datetime的处理非常好，在复杂和易用之间取得了平衡。</p><p>一句话总结起来就是</p><blockquote><p>matplotlib转换标准datetime类后才能显示在axes上。</p></blockquote><p>一般的处理步骤是</p><ol><li>string 转为 datetime</li><li>matplotlib.dates date2num 转换成matplotlib格式</li><li>作图</li></ol><p>附加上刻度的调整</p><ol><li>调整显示格式<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> matplotlib.ticker <span style=color:#f92672>import</span> MultipleLocator, FormatStrFormatter
xmajorLocator <span style=color:#f92672>=</span> MultipleLocator(<span style=color:#ae81ff>20</span>)  <span style=color:#75715e># 将x主刻度标签设置为20的倍数</span>
xmajorFormatter <span style=color:#f92672>=</span> FormatStrFormatter(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%1.1f</span><span style=color:#e6db74>&#39;</span>)  <span style=color:#75715e># 设置x轴标签文本的格式</span>
xminorLocator <span style=color:#f92672>=</span> MultipleLocator(<span style=color:#ae81ff>5</span>)  <span style=color:#75715e># 将x轴次刻度标签设置为5的倍数</span>
</code></pre></div></li><li>日期的格式<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>mdates<span style=color:#f92672>.</span>DateFormatter(<span style=color:#e6db74>&#39;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#39;</span>)
</code></pre></div></li></ol><h2 id=日期的合并>日期的合并</h2><p>除了shared坐标轴外，我们通常会遇到两个数据合集，然后共享一个时间轴，例如K线和成交量，需要画两个图，但是共享一个坐标轴。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>sharex<span style=color:#f92672>=</span>True
</code></pre></div><p>另一种暴力做法是做法是使用pandas的merge功能合并连个数据集合。</p><h2 id=左右坐标轴>左右坐标轴</h2><p>关键的一句是</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>ax2 <span style=color:#f92672>=</span> ax<span style=color:#f92672>.</span>twinx()
</code></pre></div><p>用ax的twinx来创建第二个副axes，其他所有的配置是一样的。</p><h2 id=plot函数可以引入哪些参数>plot函数可以引入哪些参数</h2><p>最常用的是plot(x,y,&lsquo;marker-line-color&rsquo;)</p><p><a href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.plot.html?highlight=plot#matplotlib.pyplot.plot"></a></p><h2 id=尾声>尾声</h2><p>最最重要的，我们在使用matplotlib时以实用为第一目的，样式和格式是最不重要的事情，甚至可以忽略。</p><p>再好的图，数据才是重点，呈现出来已经达到99%的目的，至于样子臭美，见鬼去吧。</p><p>掌握了以上几个关键的matplotlib概念，至少可以延期你的放弃年头大概个把月（狗头）。</p></p></div></article><div style=text-align:center><p>关注公众号：<strong>结丹记事本儿</strong>，获取更新提醒和教程</p><img src=/img/weixin.jpg width=110px;><article id=single><a href=http://52etf.net/blog/%E5%85%8D%E8%B4%B9cdn%E7%9A%84%E6%9C%80%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/>下一篇：免费CDN的最正确使用姿势</a> &nbsp;
<a href=http://52etf.net/blog/%E6%8A%93%E5%8F%96%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7/>上一篇：抓取微信公众号内容</a></article></div><article class=single><strong>推荐目录：</strong>
<a class=item__tag href=/tags/matplotlib>#matplotlib</a></article><script src=//unpkg.com/valine/dist/Valine.min.js></script><div id=vcomments></div><script>new Valine({el:'#vcomments',appId:'oc9Q6EXPyOTsTB1u3TF69zx5-gzGzoHsz',appKey:'K9hd59av2lhDkYwXfBGAHFdB',placeholder:'请您在评论时遵守国家法律法规，谢谢',visitor:false,})</script></main><footer id=footer><ol><li><a href=http://52etf.net>版权&copy;52etf.net</a></li><li><a href=https://creativecommons.org/licenses/by-sa/4.0/deed.zh>协议CC BY-SA 4.0</a></li><li><a href=http://www.beian.miit.gov.cn>豫ICP备20016066号</a></li></ol></footer></body></html>