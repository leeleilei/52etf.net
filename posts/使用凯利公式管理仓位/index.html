<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="前言 仓位管理是投资时的一个基础要点，有人动辄满仓空仓，有人二股八债轮动、有人按部就班按估值建仓，貌似没有标准去界定一个合理仓位区间。 我接触长赢指数投资后，得出的结论是使用估值分位数，估值和分位数越低，"><meta name=KEYWORDS content="[仓位 凯利公式]"><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><base href=http://52etf.net/posts/%E4%BD%BF%E7%94%A8%E5%87%AF%E5%88%A9%E5%85%AC%E5%BC%8F%E7%AE%A1%E7%90%86%E4%BB%93%E4%BD%8D/><meta property="og:title" content="如何用凯利公式来管理基金仓位 | 我爱ETF"><meta name=twitter:title content="如何用凯利公式来管理基金仓位 | 我爱ETF"><meta itemprop=name content="如何用凯利公式来管理基金仓位 | 我爱ETF"><meta name=application-name content="如何用凯利公式来管理基金仓位 | 我爱ETF"><meta property="og:site_name" content><meta name=description content="前言 仓位管理是投资时的一个基础要点，有人动辄满仓空仓，有人二股八债轮动、有人按部就班按估值建仓，貌似没有标准去界定一个合理仓位区间。 我接触长赢指数投资后，得出的结论是使用估值分位数，估值和分位数越低，"><meta itemprop=description content="前言 仓位管理是投资时的一个基础要点，有人动辄满仓空仓，有人二股八债轮动、有人按部就班按估值建仓，貌似没有标准去界定一个合理仓位区间。 我接触长赢指数投资后，得出的结论是使用估值分位数，估值和分位数越低，"><meta property="og:description" content="前言 仓位管理是投资时的一个基础要点，有人动辄满仓空仓，有人二股八债轮动、有人按部就班按估值建仓，貌似没有标准去界定一个合理仓位区间。 我接触长赢指数投资后，得出的结论是使用估值分位数，估值和分位数越低，"><meta name=twitter:description content="前言 仓位管理是投资时的一个基础要点，有人动辄满仓空仓，有人二股八债轮动、有人按部就班按估值建仓，貌似没有标准去界定一个合理仓位区间。 我接触长赢指数投资后，得出的结论是使用估值分位数，估值和分位数越低，"><meta name=url content="http://52etf.net/posts/%E4%BD%BF%E7%94%A8%E5%87%AF%E5%88%A9%E5%85%AC%E5%BC%8F%E7%AE%A1%E7%90%86%E4%BB%93%E4%BD%8D/"><meta name=twitter:url content="http://52etf.net/posts/%E4%BD%BF%E7%94%A8%E5%87%AF%E5%88%A9%E5%85%AC%E5%BC%8F%E7%AE%A1%E7%90%86%E4%BB%93%E4%BD%8D/"><meta property="og:url" content="http://52etf.net/posts/%E4%BD%BF%E7%94%A8%E5%87%AF%E5%88%A9%E5%85%AC%E5%BC%8F%E7%AE%A1%E7%90%86%E4%BB%93%E4%BD%8D/"><link rel=canonical href=http://52etf.net/posts/%E4%BD%BF%E7%94%A8%E5%87%AF%E5%88%A9%E5%85%AC%E5%BC%8F%E7%AE%A1%E7%90%86%E4%BB%93%E4%BD%8D/ itemprop=url><link id=favicon rel=icon type=image/x-icon href=/img/favicon.ico><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/github-markdown.min.css><link rel=stylesheet href=/css/addon.css><meta name=referrer content="no-referrer"><title>我爱ETF</title></head><body><header id=header><nav class=topnav id=myTopNav><ol><li><a href=/>首页</a></li><li><a href=/dash/>市场仪表盘</a></li><li><a href=/books/>投资书单</a></li><li><a href=/funds/>精选基金</a></li><li><a href=/tools/>量化工具</a></li><li><a href=/tags/>词云</a></li><li><a href=/blog/>博客</a></li><li><a href=/about/>关于</a></li></ol></nav></header><main id=main><article class=markdown-body><h1>如何用凯利公式来管理基金仓位
<span class=article_date>Jun 23, 2020</span></h1><h2 id=前言>前言</h2><p>仓位管理是投资时的一个基础要点，有人动辄满仓空仓，有人二股八债轮动、有人按部就班按估值建仓，貌似没有标准去界定一个合理仓位区间。</p><p>我接触长赢指数投资后，得出的结论是使用估值分位数，估值和分位数越低，显然胜率越大，那么投注的比例也应该越大，大致的公式是</p><blockquote><p>f = 1 - q</p></blockquote><ol><li>f是仓位</li><li>P是估值分位</li></ol><p>比如估值点的分位数是15%，那么仓位应该在85%。</p><p>再后来了解到凯利公式，遂发现很多人推崇这儿公式，结果在多数时候也还凑合，然而其背后的假设和结果的意义却被忽视。</p><p>本文主要探讨，凯利公式的局限性，以及如何确定仓位。</p><h2 id=分位的概念>分位的概念</h2><p>要理解凯利公式和投资下注的比例，就要先理解分位数这个概念。</p><p>在数学上分位数代表的是一个样本（估值）在从小到大样本空间内（所有历史估值）的小于该样本的频率统计值，直白理解是<strong>在历史上出现过低于估值的频率是XX百分比</strong>。</p><p>比如说，中证红利PE估值10的分位数是6%，那么代表着在历史上中证红利出现估值10以下的频率只有15%。</p><p>由于我们相信市场有效假说，相信均值回归理论，同时从历史PE规律（确实有很多的假设前提），我们确定6-10内（又一个时间假设），此刻买入后的胜率的是1-6% = 94%。</p><p>诸多的假设和分位值一同构成我们决策仓位的依据，缺一不可。如果我们不相信市场均值回归，持有的资产拿不到10年后（比如亏损后中途下车，或者3年后就调整了策略），那么这个结论就不成立。</p><p>好了，<strong>那么在胜率95%的前提下，我们该投入多少本金才是最优？</strong>。为什么这么问，因为如果仓位过重，遭遇黑天鹅就会放大损失，投入过少时收益率又不足，这个问题其实就是凯利公式要解决的。</p><h2 id=什么是凯利公式>什么是凯利公式</h2><p>来自维基百科的定义，</p><blockquote><p>凯利公式（英语：Kelly formula），也称凯利方程式，是一个用以使特定赌局中，拥有正期望值之重复行为长期增长率最大化的公式，由约翰·拉里·凯利于1956年在《贝尔系统技术期刊》中发表，可用以计算出每次游戏中应投注的资金比例。除可将长期增长率最大化外，此方程式不允许在任何赌局中，有失去全部现有资金的可能，因此有不存在破产疑虑的优点。方程式假设货币与赌局可无穷分割，而只要资金足够多，在实际应用上不成问题。</p></blockquote><p>常见的简化公式，</p><p><img src=https://cdn.jsdelivr.net/gh/leeleilei/leeleilei.github.io/assets/images/20200624151354.png alt=20200624151354>
或者 另一种推导形式，</p><p><img src=https://cdn.jsdelivr.net/gh/leeleilei/leeleilei.github.io/assets/images/20200624100634.png alt=20200624100634></p><ol><li>f是自己所剩余的预备投注的资金比例</li><li>p为赢的概率</li><li>rw(return of win) 是赢时的净收益率，不含本金，例如在赌局1中rw=1，表示完全损失本金。投资基金时，就是牛市顶峰我们的收益率。</li><li>rl(return of loss) 是输时的净损失率，例如在赌局1中rl=1，表示赚取一倍的收益，注意此处rl>0</li><li>b表示投注可得的赔率，不含本金</li></ol><p>凯利公式的数学推论非常复杂，我不是数学专业也说不出个屁来，但不影响主观的理解其原理、局限性。</p><h2 id=局限和意义>局限和意义</h2><p>这个公式跟概率论有关，<strong>所有涉及概率的都会有大的假设，比如样本空间</strong>。举个例子，都知道投掷硬币时正面的概率是50%，那么是不是打赌时投掷正面出现频率一定是50%呢？</p><p>其实不是，我们打赌是有限次数，出现正面的次数绝对不是50%。如果约定，不吃不喝每时每刻投掷硬币几个月，此时的频率分布才接近50%。</p><p>无限样本空间是概率论的基础，数量会稀释掉反面比例，趋于回归值，而不是提高了正面的概率。</p><p>同理，<strong>如果将凯利公式应用于投资市场，那么就假设了赌局无限分割，也就是无限次的参与设置仓位，无限的资金可以补仓。</strong></p><p>显然，这是不可能的，人的一生只有几十年，大概经历3次低估，会跟这个模型的预期产生非常大的差异。就像你打赌投掷硬币4次，你说概率是50%，最多输2次，实际可能输4次，胜率是0。</p><p>另外，凯利公式是对赌模型，也就是你输我赢的零和市场的行为，用在赌博游戏、期货市场（对赌）是有效的。</p><p>用在股票、基金市场，这个对赌模型就有了另外的意义，变成我（投资人）和市场价格（所有其他全体）的对赌，赔率就是低位和高位的价格比，胜率就是一定时期（10年内）内估值（一个指标）的回归概率。这个数学意义倒是问题不大，没有偏离模型太多。</p><h2 id=简化版的凯利公式>简化版的凯利公式</h2><p>在投资论坛中常看到另一种简化形式，</p><blockquote><p>f = 2p -1</p></blockquote><p>其实是假设了rw, rl = 1，就是赌博的情形，赢了翻倍，输了为0。公式依赖于胜率p，由于我们使用估值分位来替代胜率，所以可以得出</p><blockquote><p>f = 1 - 2q</p></blockquote><p>q 就是 估值分位，也就是越低分位，输的概率越低。可以看出当估值处于50%以下时，可以采取行动买入，否则就应按等待。</p><h2 id=动态杠杆版本>动态/杠杆版本</h2><p>实际投资时，rw和rl不是1，rw在牛市高峰预期收益rw可能是2倍，对于rl存在一个最大回撤，有一个保底价格。</p><p>例如PE 10，分位数是5%，此时买入，按照估值和价格历史对应关系，PE最大时价格rw=1.5，PE最低8，价格最大回撤15%，那么计算结果应该是，</p><blockquote><p>f = 0.85/0.15 - 0.15/1.5 = 6</p></blockquote><p>也就是可以投入600%的仓位去投资，意思是可以加6倍的杠杆，我？？？</p><p><img src=https://cdn.jsdelivr.net/gh/leeleilei/leeleilei.github.io/assets/images/20200624144127.png alt=20200624144127></p><h2 id=为什么结果出入这么大>为什么结果出入这么大</h2><p>这个结果是真实的，但是存在一些假定的前提。还记得开篇凯利公式假设吗，赌局可以无限分割（发生次数），资金永远充足。</p><p>这个结果的现实意义在于，未来你还有无数次的机会去做同样的动作，无限次经历钻石底，无限次的投注，经历2015年-2020年牛熊交替后，最终你的胜率。</p><p>然而实际情况呢，A股有效数据历史一共20年，PE 5%分位的次数一共3次，且不说模型的有效性，未来一个投资人能有几次机会？可能一次就破产了，不会再有很多次去做同样的赌注来弥补单次的损失。</p><p>所以这个结果有效，但没有实际操作用途。</p><h2 id=开下脑壳>开下脑壳</h2><p>那么是不是一个富二代，增加交易次数就可以模拟无限分割，然后一定盈利呢？</p><p>理论上是的，但是产生这个概率的对象要调整，钻石底不可能发生很多次。需要找一个有效指标，这个指标跟盈利有大于50%的相关性，且样本足够支撑相关性。比如一个分钟级别的指标，出现某种波动时，盈利概率大于55%，那么这个指标有效，就可以无限次的交易，用大数概率来磨平短期的亏损。（当然也要考虑交易损耗等）</p><p>等等，我好想发现了致富的路子！找到这个指标不就行了？是的，这也是全球的量化精英们，穷极一生在做的事情，鲜有人成功。当你成功时，指标会被复制粘贴，在市场中失效。</p><h2 id=那么到底如何确定仓位>那么到底如何确定仓位</h2><p>靠玄学吗？还真是，多数人靠的是经验，最初提到的2P-1其实也是一个经验值。</p><p>从长赢指数投资的经验来看，首先仓位用作整体资金配置的估算，比如益达建议你当前环境下，持仓最低多少最多是多少。不会告诉你养老产业的持仓应该是多少。</p><p>从以往数据推理，长赢的资产仓位大致符合 f = 2P - 1，并在此基础上给出5-10%点的削减预留（应对黑天鹅）。</p><h2 id=进一步的思考>进一步的思考</h2><p>如果真要去确定一个准确的仓位值，可以用回测模拟的方法来回归一个值，设置不同的持仓，针对长赢策略，看看哪个仓位规则下，获取的收益最大。</p><p>用这个方法得出的值才基本可信，但不是100准确，。我们都知道过去不代表未来，回测的样本也非常小，况且不同的标的，PE趋势不同，仓位值可能又不同。</p><h2 id=注意事项>注意事项</h2><p>因为我们推崇的是长期资产配置，低买高卖，交易的频率很低，交易的时间集中在指数低估期间和高估值卖出区间。</p><p>比如，估值分位20%以下和80%以上是买入和卖出时刻。所以在估值正常的区间，是不需要关注和调整持仓份额的。</p><h2 id=尾声>尾声</h2><p>凯利公式及其简化版本给基金持仓份额提供了一种简洁的配置思路</p><blockquote><p>f = 1 - 2q (q是估值分位值)</p></blockquote><p>从经验看，这个公式能够较好的指导我们的整体仓位（还没看到相关的有效性验证文章）。</p><p>另外，公式很明显的告诉我两个原则：</p><ol><li>如果f算出来是0，表示这是一个期望收益为0的游戏，最优决策是不参加。</li><li>如果f算出来是负数，表示这是一个期望收益为负的游戏，更是不能参加了</li></ol><p>也就是分位数在50%以上时，对于长期资产配置来说，就不要买入了。</p></article><article id=article_tags><a class=item__tag href=/tags/%E4%BB%93%E4%BD%8D>#仓位</a>
<a class=item__tag href=/tags/%E5%87%AF%E5%88%A9%E5%85%AC%E5%BC%8F>#凯利公式</a></article><div style=text-align:center><img src=/img/weixin_banner.png width=40%;></div><article id=article_nav><a href=http://52etf.net/posts/%E7%AE%A1%E7%90%86%E5%A5%BD%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BB%93%E4%BD%8D/>新一篇：管理好自己的仓位</a>
<a href=http://52etf.net/posts/%E5%B7%A6%E4%BE%A7%E8%BF%98%E6%98%AF%E5%8F%B3%E4%BE%A7%E4%BA%A4%E6%98%93/>老一篇：左侧还是右侧交易</a></article><script src=//unpkg.com/valine/dist/Valine.min.js></script><div id=vcomments></div><script>new Valine({el:'#vcomments',appId:'oc9Q6EXPyOTsTB1u3TF69zx5-gzGzoHsz',appKey:'K9hd59av2lhDkYwXfBGAHFdB',placeholder:'请您在评论时遵守国家法律法规，谢谢',visitor:false,})</script></main><footer id=footer><ul><li><a href=http://52etf.net>版权&copy;52etf.net</a></li><li><a href=https://creativecommons.org/licenses/by-sa/4.0/deed.zh>协议CC BY-SA 4.0</a></li><li><a href=http://www.beian.miit.gov.cn>豫ICP备20016066号</a></li></ul></footer></body></html>